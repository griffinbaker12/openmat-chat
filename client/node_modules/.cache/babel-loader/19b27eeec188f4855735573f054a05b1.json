{"ast":null,"code":"var _jsxFileName = \"/Users/griffinbaker/Desktop/chat-application/client/src/components/notification-dropdown/notification-dropdown.component.jsx\",\n    _s = $RefreshSig$();\n\nimport { forwardRef, useRef, useEffect, useState } from 'react';\nimport { useAuthentication } from '../../contexts/authentication-context';\nimport { useChatView } from '../../contexts/chat-view-context';\nimport { generateChatNameForSoloChats, defaultToast, TOAST_TYPE } from '../../utils/utils';\nimport './notification-dropdown.styles.scss';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst NotificationDropdown = /*#__PURE__*/_s( /*#__PURE__*/forwardRef(_c = _s((_ref, ref) => {\n  _s();\n\n  let {\n    handleDropdown,\n    closeAccountDropdown,\n    closeNotificationDropdown\n  } = _ref;\n  const {\n    notifications,\n    setActiveChat,\n    chats,\n    setNotifications,\n    setUnreadMessages\n  } = useChatView();\n  const {\n    currentUser\n  } = useAuthentication();\n  const [groupedNotifications, setGroupedNotifications] = useState([]);\n  const dropDownRef = useRef();\n\n  const handleSignOutClick = e => {\n    if (ref.current === e.target.closest('.header-chat-link')) {\n      return;\n    }\n\n    if (dropDownRef.current && !dropDownRef.current.contains(e.target)) {\n      closeNotificationDropdown();\n    }\n  };\n\n  useEffect(() => {\n    document.addEventListener('mousedown', handleSignOutClick);\n    return () => document.removeEventListener('mousedown', handleSignOutClick);\n  });\n  useEffect(() => {\n    const chatCounter = [];\n    if (notifications.length === 0) return;\n    notifications.forEach(notification => {\n      const alreadyInCounterIndex = chatCounter.findIndex(notificaitonInChatCounter => notificaitonInChatCounter.chat._id === notification.message.chat._id);\n\n      if (alreadyInCounterIndex >= 0) {\n        let objToInc = chatCounter[alreadyInCounterIndex];\n        objToInc.count = objToInc.count + 1;\n      } else {\n        chatCounter.push({\n          chat: notification.message.chat,\n          count: 1\n        });\n      }\n    });\n    setGroupedNotifications(chatCounter);\n  }, [notifications]);\n\n  const handleNotificationClick = async e => {\n    const chatId = e.target.closest('.notification-dropdown-content-item-container').getAttribute('name');\n    const chat = chats.find(chat => chat._id === chatId);\n    setActiveChat([chat]);\n    const unreadNotificationsInChat = notifications.filter(notification => notification.chat._id === chatId);\n    setUnreadMessages(unreadNotificationsInChat); // Should remove all notifications for a certain user in a chat\n\n    try {\n      const response = await fetch(`http://localhost:4000/api/notification/removeNotification`, {\n        method: 'post',\n        headers: {\n          Authorization: `Bearer ${currentUser.token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          chatId: chat._id\n        })\n      });\n      const updatedNotifications = await response.json();\n      setNotifications(updatedNotifications);\n    } catch (error) {\n      defaultToast(TOAST_TYPE.error, 'Error updating notifications');\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onClick: handleSignOutClick,\n    ref: dropDownRef,\n    className: \"notification-dropdown-container\",\n    children: notifications.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        padding: '20px',\n        textAlign: 'center'\n      },\n      children: \"No new notifications!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }, this) : groupedNotifications.map((groupedNotification, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: handleNotificationClick,\n      name: groupedNotification.chat._id,\n      className: \"notification-dropdown-content-item-container\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [groupedNotification.count === 1 ? 'New message' : `${groupedNotification.count} new messages`, ' ', groupedNotification.chat.isGroupChat ? `in ${groupedNotification.chat.chatName}` : `from ${generateChatNameForSoloChats(groupedNotification.chat.users, currentUser)}`]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 15\n      }, this)\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 7\n  }, this);\n}, \"fSMnw5czYKZEb2ibhQMhgNVp39E=\", false, function () {\n  return [useChatView, useAuthentication];\n})), \"fSMnw5czYKZEb2ibhQMhgNVp39E=\", false, function () {\n  return [useChatView, useAuthentication];\n});\n\n_c2 = NotificationDropdown;\nexport default NotificationDropdown;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"NotificationDropdown$forwardRef\");\n$RefreshReg$(_c2, \"NotificationDropdown\");","map":{"version":3,"names":["forwardRef","useRef","useEffect","useState","useAuthentication","useChatView","generateChatNameForSoloChats","defaultToast","TOAST_TYPE","NotificationDropdown","ref","handleDropdown","closeAccountDropdown","closeNotificationDropdown","notifications","setActiveChat","chats","setNotifications","setUnreadMessages","currentUser","groupedNotifications","setGroupedNotifications","dropDownRef","handleSignOutClick","e","current","target","closest","contains","document","addEventListener","removeEventListener","chatCounter","length","forEach","notification","alreadyInCounterIndex","findIndex","notificaitonInChatCounter","chat","_id","message","objToInc","count","push","handleNotificationClick","chatId","getAttribute","find","unreadNotificationsInChat","filter","response","fetch","method","headers","Authorization","token","body","JSON","stringify","updatedNotifications","json","error","padding","textAlign","map","groupedNotification","i","isGroupChat","chatName","users"],"sources":["/Users/griffinbaker/Desktop/chat-application/client/src/components/notification-dropdown/notification-dropdown.component.jsx"],"sourcesContent":["import { forwardRef, useRef, useEffect, useState } from 'react';\nimport { useAuthentication } from '../../contexts/authentication-context';\nimport { useChatView } from '../../contexts/chat-view-context';\nimport {\n  generateChatNameForSoloChats,\n  defaultToast,\n  TOAST_TYPE,\n} from '../../utils/utils';\nimport './notification-dropdown.styles.scss';\n\nconst NotificationDropdown = forwardRef(\n  (\n    { handleDropdown, closeAccountDropdown, closeNotificationDropdown },\n    ref\n  ) => {\n    const {\n      notifications,\n      setActiveChat,\n      chats,\n      setNotifications,\n      setUnreadMessages,\n    } = useChatView();\n    const { currentUser } = useAuthentication();\n    const [groupedNotifications, setGroupedNotifications] = useState([]);\n    const dropDownRef = useRef();\n\n    const handleSignOutClick = e => {\n      if (ref.current === e.target.closest('.header-chat-link')) {\n        return;\n      }\n      if (dropDownRef.current && !dropDownRef.current.contains(e.target)) {\n        closeNotificationDropdown();\n      }\n    };\n\n    useEffect(() => {\n      document.addEventListener('mousedown', handleSignOutClick);\n      return () =>\n        document.removeEventListener('mousedown', handleSignOutClick);\n    });\n\n    useEffect(() => {\n      const chatCounter = [];\n      if (notifications.length === 0) return;\n      notifications.forEach(notification => {\n        const alreadyInCounterIndex = chatCounter.findIndex(\n          notificaitonInChatCounter =>\n            notificaitonInChatCounter.chat._id === notification.message.chat._id\n        );\n        if (alreadyInCounterIndex >= 0) {\n          let objToInc = chatCounter[alreadyInCounterIndex];\n          objToInc.count = objToInc.count + 1;\n        } else {\n          chatCounter.push({ chat: notification.message.chat, count: 1 });\n        }\n      });\n      setGroupedNotifications(chatCounter);\n    }, [notifications]);\n\n    const handleNotificationClick = async e => {\n      const chatId = e.target\n        .closest('.notification-dropdown-content-item-container')\n        .getAttribute('name');\n      const chat = chats.find(chat => chat._id === chatId);\n      setActiveChat([chat]);\n      const unreadNotificationsInChat = notifications.filter(\n        notification => notification.chat._id === chatId\n      );\n      setUnreadMessages(unreadNotificationsInChat);\n\n      // Should remove all notifications for a certain user in a chat\n      try {\n        const response = await fetch(\n          `http://localhost:4000/api/notification/removeNotification`,\n          {\n            method: 'post',\n            headers: {\n              Authorization: `Bearer ${currentUser.token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              chatId: chat._id,\n            }),\n          }\n        );\n        const updatedNotifications = await response.json();\n        setNotifications(updatedNotifications);\n      } catch (error) {\n        defaultToast(TOAST_TYPE.error, 'Error updating notifications');\n      }\n    };\n\n    return (\n      <div\n        onClick={handleSignOutClick}\n        ref={dropDownRef}\n        className=\"notification-dropdown-container\"\n      >\n        {notifications.length === 0 ? (\n          <p\n            style={{\n              padding: '20px',\n              textAlign: 'center',\n            }}\n          >\n            No new notifications!\n          </p>\n        ) : (\n          groupedNotifications.map((groupedNotification, i) => (\n            <div\n              onClick={handleNotificationClick}\n              name={groupedNotification.chat._id}\n              key={i}\n              className=\"notification-dropdown-content-item-container\"\n            >\n              <p>\n                {groupedNotification.count === 1\n                  ? 'New message'\n                  : `${groupedNotification.count} new messages`}{' '}\n                {groupedNotification.chat.isGroupChat\n                  ? `in ${groupedNotification.chat.chatName}`\n                  : `from ${generateChatNameForSoloChats(\n                      groupedNotification.chat.users,\n                      currentUser\n                    )}`}\n              </p>\n            </div>\n          ))\n        )}\n      </div>\n    );\n  }\n);\nexport default NotificationDropdown;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}