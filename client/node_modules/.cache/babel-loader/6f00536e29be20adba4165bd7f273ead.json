{"ast":null,"code":"var _jsxFileName = \"/Users/griffinbaker/Desktop/chat-application/client/src/components/message-view/message-view.component.jsx\",\n    _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport Lottie from 'lottie-react';\nimport { useChatView } from '../../contexts/chat-view-context';\nimport Spinner from '../spinner/spinner.component';\nimport './message-view.styles.scss';\nimport { useAuthentication } from '../../contexts/authentication-context';\nimport animationData from '../../animations/typing.json';\nimport { defaultToast, sameSenderAndNotCurrentUser, TOAST_TYPE, userSent, getTyperString } from '../../utils/utils';\nimport { useSocket } from '../../contexts/socket-context'; // Could definitely add timestamp data to the message as well, that would be pretty clean actually\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nlet typingTimer;\nconst ENDPOINT = 'http://localhost:4000';\n\nconst MessageView = () => {\n  _s();\n\n  // Somehow we are going to have to get all of the message in a conversation potentially and then mark whether or not they are your messages or someone else's to style accordingly;\n  const {\n    currentUser\n  } = useAuthentication();\n  const {\n    activeChat,\n    notifications,\n    setNotifications,\n    fetchChats\n  } = useChatView();\n  const socket = useSocket();\n  console.log('ac from outside', activeChat[0]._id); // const [socketConnected, setSocketConnected] = useState(false);\n\n  const [messages, setMessages] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isTyping, setIsTyping] = useState(false);\n  const [typing, setTyping] = useState(false);\n  const [typers, setTypers] = useState([]); // console.log('typers from outside', typers);\n  // So I am thinking that I can definitely scroll into view whatever message is actually clicked within whatever chat, I don't see why that would not be possible?\n  // Pretty cool, when the component actually mounts, the ref for the element gets passed into the callback function, could actually do some pretyy coll things with this, like making an animation or shake the screen or bounce the message or anything when the message actually enters the screen...\n\n  const handleKeyDown = async e => {\n    if (!socket) return;\n    const newMessage = e.target.innerHTML;\n\n    if (e.key === 'Enter' && newMessage) {\n      e.preventDefault();\n      e.target.innerHTML = '';\n\n      try {\n        const response = await fetch(`http://localhost:4000/api/message`, {\n          method: 'post',\n          headers: {\n            Authorization: `Bearer ${currentUser.token}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            chatId: activeChat[0]._id,\n            text: newMessage\n          })\n        });\n        const message = await response.json();\n        socket.emit('send-msg', message);\n        setMessages(prevState => [...prevState, message]);\n        setTyping(false);\n        return;\n      } catch (error) {\n        defaultToast(TOAST_TYPE.error, 'Error sending');\n      }\n    } else {\n      if (!typing) {\n        setTyping(true);\n        socket.emit('typing', activeChat[0]._id, currentUser);\n      }\n\n      const lastTypingTime = new Date().getTime();\n      const timerLength = 3000;\n      if (typingTimer) clearTimeout(typingTimer);\n      typingTimer = setTimeout(() => {\n        const timeNow = new Date().getTime();\n        const timeDiff = timeNow - lastTypingTime;\n\n        if (timeDiff >= timerLength) {\n          socket.emit('stop typing', activeChat[0]._id, currentUser);\n          setTyping(false);\n        }\n      }, timerLength);\n    }\n  };\n\n  const fetchMessages = useCallback(async () => {\n    if (!socket) return;\n    if (!activeChat) return;\n    setIsLoading(true);\n    const response = await fetch(`http://localhost:4000/api/message/${activeChat[0]._id}`, {\n      method: 'get',\n      headers: {\n        Authorization: `Bearer ${currentUser.token}`\n      }\n    });\n    const messages = await response.json();\n    setMessages(messages);\n    setIsLoading(false);\n  }, [activeChat, currentUser.token, socket]);\n  useEffect(() => {\n    fetchMessages();\n  }, [fetchMessages, activeChat]);\n  useEffect(() => {\n    if (!socket) return;\n    socket.emit('join room', activeChat[0]._id);\n    return () => socket.emit('leave room', activeChat[0]._id);\n  }, [activeChat, socket]);\n  useEffect(() => {\n    if (!socket) return;\n    socket.on('msg-received', message => {\n      if (!activeChat._id || message.chat_.id !== activeChat[0]._id) {\n        setNotifications();\n      }\n\n      setMessages(prevState => [...prevState, message]);\n    });\n    return () => socket.off('msg-received');\n  }, [socket, activeChat, setNotifications]); // useEffect(() => {\n  //   // Well I want to try moving the setup to the main socket and then when the chat changes just the chatId obviously, this could work, because then each user ahs a room of their own, and each room creates their own room of sorts as well\n  //   if (!socket) return;\n  //   // For when the user refreshes the page or leaves the chat, otherwise the lottie is suspended\n  //   socket.emit('join chat', activeChat[0]._id);\n  //   socket.emit('stop typing', activeChat[0]._id, currentUser);\n  //   socket.on('typing', typer => {\n  //     setIsTyping(true);\n  //     setTypers(prevState => [...new Set([typer, ...prevState])]);\n  //   });\n  //   return () => socket.emit('leave chat', activeChat[0]._id);\n  // }, [currentUser, activeChat, socket]);\n  // useEffect(() => {\n  //   if (!socket) return;\n  //   // socket.on('message received', message => {\n  //   //   console.log('received');\n  //   //   setIsTyping(false);\n  //   //   console.log('message rec', message.chat._id, 'ac', activeChat[0]._id);\n  //   //   if (!activeChat[0]._id || message.chat._id !== activeChat[0]._id) {\n  //   //     if (!notifications) return;\n  //   //     setNotifications(prevState => [message, ...prevState]);\n  //   //     return;\n  //   //   } else {\n  //   //     setMessages(prevState => {\n  //   //       return [...prevState, message];\n  //   //     });\n  //   //   }\n  //   });\n  // }, [activeChat, fetchChats, notifications, socket, setNotifications]);\n  // useEffect(() => {\n  //   if (!socket) return;\n  //   socket.on('stop typing', userName => {\n  //     const usersStillTyping = typers.filter(typer => typer !== userName);\n  //     if (usersStillTyping.length > 0 && typers.length !== 0) {\n  //       setIsTyping(true);\n  //       setTypers(usersStillTyping);\n  //       return;\n  //     }\n  //     setIsTyping(false);\n  //     setTypers([]);\n  //   });\n  // }, [typers, socket]);\n\n  const setRef = useCallback(node => {\n    if (node) {\n      node.scrollIntoView({\n        smooth: true\n      });\n    }\n  }, []); // What is the best way to make it so that the text bubble can expland if it needs to??\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message-view-container\",\n    children: isLoading ? /*#__PURE__*/_jsxDEV(Spinner, {\n      type: \"search\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message-view-active-chat-container\",\n        children: [messages.length > 0 && messages.map((message, i) => {\n          const lastMessageBool = messages.length - 1 === i + 1;\n          const userSentBool = userSent(currentUser, message);\n          const sameSenderAndNotCurrentUserBool = sameSenderAndNotCurrentUser(i, messages, currentUser);\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: lastMessageBool ? setRef : null,\n            className: `message-view-message-container ${userSentBool ? 'user-sent' : ''}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-view-message-image-container\",\n              style: sameSenderAndNotCurrentUserBool || userSentBool ? {\n                visibility: 'hidden'\n              } : {\n                marginTop: '2px'\n              },\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                height: \"100%\",\n                src: message.sender.picture,\n                alt: \"profile\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 208,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-view-text-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-view-text\",\n                children: message.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 215,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: sameSenderAndNotCurrentUserBool || userSentBool ? {\n                  display: 'none'\n                } : {},\n                className: \"message-view-text-info\",\n                children: /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: [\"@\", !userSentBool ? message.sender.userName : 'You']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 224,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 214,\n              columnNumber: 21\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 19\n          }, this);\n        }), isTyping && /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: isTyping ? setRef : null,\n          className: \"lottie-container\",\n          children: [typers.length ? getTyperString(typers) : '', /*#__PURE__*/_jsxDEV(Lottie, {\n            animationData: animationData,\n            loop: true,\n            autoplay: true,\n            style: {\n              height: '16px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"send-message-editable\",\n        \"data-text\": `Message `,\n        contentEditable: true,\n        onKeyDown: handleKeyDown\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 180,\n    columnNumber: 5\n  }, this);\n};\n\n_s(MessageView, \"/975FbFasSbF7q/ASGQtXKp51R4=\", false, function () {\n  return [useAuthentication, useChatView, useSocket];\n});\n\n_c = MessageView;\nexport default MessageView;\n\nvar _c;\n\n$RefreshReg$(_c, \"MessageView\");","map":{"version":3,"names":["useCallback","useEffect","useState","io","Lottie","useChatView","Spinner","useAuthentication","animationData","defaultToast","sameSenderAndNotCurrentUser","TOAST_TYPE","userSent","getTyperString","useSocket","typingTimer","ENDPOINT","MessageView","currentUser","activeChat","notifications","setNotifications","fetchChats","socket","console","log","_id","messages","setMessages","isLoading","setIsLoading","isTyping","setIsTyping","typing","setTyping","typers","setTypers","handleKeyDown","e","newMessage","target","innerHTML","key","preventDefault","response","fetch","method","headers","Authorization","token","body","JSON","stringify","chatId","text","message","json","emit","prevState","error","lastTypingTime","Date","getTime","timerLength","clearTimeout","setTimeout","timeNow","timeDiff","fetchMessages","on","chat_","id","off","setRef","node","scrollIntoView","smooth","length","map","i","lastMessageBool","userSentBool","sameSenderAndNotCurrentUserBool","visibility","marginTop","sender","picture","display","userName","height"],"sources":["/Users/griffinbaker/Desktop/chat-application/client/src/components/message-view/message-view.component.jsx"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport Lottie from 'lottie-react';\nimport { useChatView } from '../../contexts/chat-view-context';\nimport Spinner from '../spinner/spinner.component';\nimport './message-view.styles.scss';\nimport { useAuthentication } from '../../contexts/authentication-context';\nimport animationData from '../../animations/typing.json';\nimport {\n  defaultToast,\n  sameSenderAndNotCurrentUser,\n  TOAST_TYPE,\n  userSent,\n  getTyperString,\n} from '../../utils/utils';\nimport { useSocket } from '../../contexts/socket-context';\n\n// Could definitely add timestamp data to the message as well, that would be pretty clean actually\n\nlet typingTimer;\n\nconst ENDPOINT = 'http://localhost:4000';\n\nconst MessageView = () => {\n  // Somehow we are going to have to get all of the message in a conversation potentially and then mark whether or not they are your messages or someone else's to style accordingly;\n  const { currentUser } = useAuthentication();\n  const { activeChat, notifications, setNotifications, fetchChats } =\n    useChatView();\n  const socket = useSocket();\n\n  console.log('ac from outside', activeChat[0]._id);\n\n  // const [socketConnected, setSocketConnected] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isTyping, setIsTyping] = useState(false);\n  const [typing, setTyping] = useState(false);\n  const [typers, setTypers] = useState([]);\n\n  // console.log('typers from outside', typers);\n\n  // So I am thinking that I can definitely scroll into view whatever message is actually clicked within whatever chat, I don't see why that would not be possible?\n  // Pretty cool, when the component actually mounts, the ref for the element gets passed into the callback function, could actually do some pretyy coll things with this, like making an animation or shake the screen or bounce the message or anything when the message actually enters the screen...\n\n  const handleKeyDown = async e => {\n    if (!socket) return;\n    const newMessage = e.target.innerHTML;\n    if (e.key === 'Enter' && newMessage) {\n      e.preventDefault();\n      e.target.innerHTML = '';\n      try {\n        const response = await fetch(`http://localhost:4000/api/message`, {\n          method: 'post',\n          headers: {\n            Authorization: `Bearer ${currentUser.token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            chatId: activeChat[0]._id,\n            text: newMessage,\n          }),\n        });\n        const message = await response.json();\n        socket.emit('send-msg', message);\n        setMessages(prevState => [...prevState, message]);\n        setTyping(false);\n        return;\n      } catch (error) {\n        defaultToast(TOAST_TYPE.error, 'Error sending');\n      }\n    } else {\n      if (!typing) {\n        setTyping(true);\n        socket.emit('typing', activeChat[0]._id, currentUser);\n      }\n      const lastTypingTime = new Date().getTime();\n      const timerLength = 3000;\n      if (typingTimer) clearTimeout(typingTimer);\n      typingTimer = setTimeout(() => {\n        const timeNow = new Date().getTime();\n        const timeDiff = timeNow - lastTypingTime;\n        if (timeDiff >= timerLength) {\n          socket.emit('stop typing', activeChat[0]._id, currentUser);\n          setTyping(false);\n        }\n      }, timerLength);\n    }\n  };\n\n  const fetchMessages = useCallback(async () => {\n    if (!socket) return;\n    if (!activeChat) return;\n    setIsLoading(true);\n    const response = await fetch(\n      `http://localhost:4000/api/message/${activeChat[0]._id}`,\n      {\n        method: 'get',\n        headers: { Authorization: `Bearer ${currentUser.token}` },\n      }\n    );\n    const messages = await response.json();\n    setMessages(messages);\n    setIsLoading(false);\n  }, [activeChat, currentUser.token, socket]);\n\n  useEffect(() => {\n    fetchMessages();\n  }, [fetchMessages, activeChat]);\n\n  useEffect(() => {\n    if (!socket) return;\n    socket.emit('join room', activeChat[0]._id);\n    return () => socket.emit('leave room', activeChat[0]._id);\n  }, [activeChat, socket]);\n\n  useEffect(() => {\n    if (!socket) return;\n    socket.on('msg-received', message => {\n      if (!activeChat._id || message.chat_.id !== activeChat[0]._id) {\n        setNotifications();\n      }\n      setMessages(prevState => [...prevState, message]);\n    });\n    return () => socket.off('msg-received');\n  }, [socket, activeChat, setNotifications]);\n  // useEffect(() => {\n  //   // Well I want to try moving the setup to the main socket and then when the chat changes just the chatId obviously, this could work, because then each user ahs a room of their own, and each room creates their own room of sorts as well\n  //   if (!socket) return;\n  //   // For when the user refreshes the page or leaves the chat, otherwise the lottie is suspended\n  //   socket.emit('join chat', activeChat[0]._id);\n  //   socket.emit('stop typing', activeChat[0]._id, currentUser);\n  //   socket.on('typing', typer => {\n  //     setIsTyping(true);\n  //     setTypers(prevState => [...new Set([typer, ...prevState])]);\n  //   });\n  //   return () => socket.emit('leave chat', activeChat[0]._id);\n  // }, [currentUser, activeChat, socket]);\n\n  // useEffect(() => {\n  //   if (!socket) return;\n  //   // socket.on('message received', message => {\n  //   //   console.log('received');\n  //   //   setIsTyping(false);\n  //   //   console.log('message rec', message.chat._id, 'ac', activeChat[0]._id);\n  //   //   if (!activeChat[0]._id || message.chat._id !== activeChat[0]._id) {\n  //   //     if (!notifications) return;\n  //   //     setNotifications(prevState => [message, ...prevState]);\n  //   //     return;\n  //   //   } else {\n  //   //     setMessages(prevState => {\n  //   //       return [...prevState, message];\n  //   //     });\n  //   //   }\n\n  //   });\n  // }, [activeChat, fetchChats, notifications, socket, setNotifications]);\n\n  // useEffect(() => {\n  //   if (!socket) return;\n  //   socket.on('stop typing', userName => {\n  //     const usersStillTyping = typers.filter(typer => typer !== userName);\n  //     if (usersStillTyping.length > 0 && typers.length !== 0) {\n  //       setIsTyping(true);\n  //       setTypers(usersStillTyping);\n  //       return;\n  //     }\n  //     setIsTyping(false);\n  //     setTypers([]);\n  //   });\n  // }, [typers, socket]);\n\n  const setRef = useCallback(node => {\n    if (node) {\n      node.scrollIntoView({ smooth: true });\n    }\n  }, []);\n\n  // What is the best way to make it so that the text bubble can expland if it needs to??\n  return (\n    <div className=\"message-view-container\">\n      {isLoading ? (\n        <Spinner type=\"search\" />\n      ) : (\n        <>\n          <div className=\"message-view-active-chat-container\">\n            {messages.length > 0 &&\n              messages.map((message, i) => {\n                const lastMessageBool = messages.length - 1 === i + 1;\n                const userSentBool = userSent(currentUser, message);\n                const sameSenderAndNotCurrentUserBool =\n                  sameSenderAndNotCurrentUser(i, messages, currentUser);\n                return (\n                  <div\n                    key={i}\n                    ref={lastMessageBool ? setRef : null}\n                    className={`message-view-message-container ${\n                      userSentBool ? 'user-sent' : ''\n                    }`}\n                  >\n                    <div\n                      className=\"message-view-message-image-container\"\n                      style={\n                        sameSenderAndNotCurrentUserBool || userSentBool\n                          ? { visibility: 'hidden' }\n                          : { marginTop: '2px' }\n                      }\n                    >\n                      <img\n                        height=\"100%\"\n                        src={message.sender.picture}\n                        alt=\"profile\"\n                      />\n                    </div>\n                    <div className=\"message-view-text-container\">\n                      <div className=\"message-view-text\">{message.text}</div>\n                      <div\n                        style={\n                          sameSenderAndNotCurrentUserBool || userSentBool\n                            ? { display: 'none' }\n                            : {}\n                        }\n                        className=\"message-view-text-info\"\n                      >\n                        <p>\n                          @{!userSentBool ? message.sender.userName : 'You'}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            {isTyping && (\n              <div ref={isTyping ? setRef : null} className=\"lottie-container\">\n                {typers.length ? getTyperString(typers) : ''}\n                <Lottie\n                  animationData={animationData}\n                  loop={true}\n                  autoplay={true}\n                  style={{ height: '16px' }}\n                />\n              </div>\n            )}\n          </div>\n\n          <div\n            className=\"send-message-editable\"\n            data-text={`Message `}\n            contentEditable\n            onKeyDown={handleKeyDown}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default MessageView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}